<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hydration</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f2f2f7">

<style>
:root {
  --bg:#f2f2f7; --card:#fff; --blue:#0a84ff;
  --text:#1c1c1e; --secondary:#8e8e93;
}
body {
  margin:0; background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont;
  color:var(--text);
}
.container { max-width:430px; margin:auto; padding:16px; }
h1 { font-size:34px; margin-bottom:10px; }
.card {
  background:var(--card); border-radius:16px;
  padding:16px; margin-bottom:16px;
}
.big { font-size:42px; font-weight:700; }
.sub { color:var(--secondary); font-size:14px; }
button, input, select {
  width:100%; padding:12px; font-size:16px;
  border-radius:12px; border:none; margin-top:8px;
}
button { background:var(--blue); color:white; font-weight:600; }
.row { display:flex; gap:8px; }
.row > * { flex:1; }
.history { font-size:14px; }
.toggle { background:#e5f0ff; color:var(--blue); }
</style>
</head>

<body>
<div class="container">
<h1>Hydration</h1>

<div class="card">
  <div class="sub">Today</div>
  <div class="big" id="total">0 oz</div>
  <div class="sub" id="goalText">Goal: 0 oz</div>
</div>

<div class="card">
  <div class="sub">Add Liquid</div>
  <input id="name" placeholder="e.g. Water, Coffee">
  <input id="amount" type="number" placeholder="Amount">
  <button onclick="addEntry()">Add</button>
</div>

<div class="card">
  <div class="sub">Units</div>
  <button class="toggle" onclick="toggleUnit()">Toggle oz / mL</button>
</div>

<div class="card">
  <div class="sub">Weekly History</div>
  <div class="history" id="history"></div>
</div>

<div class="card">
  <div class="sub">Daily Goal</div>
  <input id="goalInput" type="number" placeholder="e.g. 64">
  <button onclick="saveGoal()">Save Goal</button>
</div>

<div class="card">
  <div class="sub">Reminders</div>
  <button onclick="calendarReminder()">Add Calendar Reminder</button>
</div>

<div class="card">
  <div class="sub">Export</div>
  <button onclick="exportNotes()">Export to Notes</button>
</div>
</div>

<script>
const today = () => new Date().toISOString().split("T")[0];

function getData() {
  return JSON.parse(localStorage.getItem("data")||"{}");
}
function saveData(d) {
  localStorage.setItem("data", JSON.stringify(d));
}

function addEntry() {
  const d = getData();
  const day = today();
  if (!d[day]) d[day]=[];
  d[day].push({
    name: name.value||"Liquid",
    amt: Number(amount.value),
    unit: localStorage.unit||"oz"
  });
  saveData(d);
  amount.value="";
  update();
}

function totalFor(day) {
  const d=getData()[day]||[];
  return d.reduce((s,e)=>s+convert(e.amt,e.unit),0);
}

function convert(val,unit) {
  return unit==="ml"? val/29.5735 : val;
}

function toggleUnit() {
  localStorage.unit = localStorage.unit==="ml"?"oz":"ml";
  update();
}

function saveGoal() {
  localStorage.goal = goalInput.value;
  update();
}

function update() {
  const t = totalFor(today());
  const unit = localStorage.unit||"oz";
  const display = unit==="ml"? Math.round(t*29.5735):Math.round(t);
  total.innerText = display+" "+unit;
  goalText.innerText = "Goal: "+(localStorage.goal||0)+" "+unit;
  renderHistory();
}

function renderHistory() {
  let out="";
  for(let i=6;i>=0;i--){
    const d=new Date(); d.setDate(d.getDate()-i);
    const k=d.toISOString().split("T")[0];
    out+=k+": "+Math.round(totalFor(k))+" oz<br>";
  }
  history.innerHTML=out;
}

function calendarReminder() {
  alert("Tip: Add a daily reminder using the iOS Calendar for best reliability.");
}

function exportNotes() {
  let text="Hydration Log\n\n";
  const d=getData();
  for(const day in d){
    text+=day+"\n";
    d[day].forEach(e=>{
      text+=`â€¢ ${e.name}: ${e.amt} ${e.unit}\n`;
    });
    text+="\n";
  }
  navigator.share({ text });
}

update();

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>