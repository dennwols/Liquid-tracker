<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Liquid Tracker</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#ffffff">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f2f2f7;
  margin: 0;
  padding: 16px;
}
h1 { font-size: 28px; margin-bottom: 12px; }
h2 { font-size: 18px; margin-bottom: 8px; }

.card {
  background: white;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

input, select, button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

button {
  background: #007aff;
  color: white;
  border: none;
  font-weight: 600;
}

.secondary {
  background: #e5e5ea;
  color: black;
}

.progress-ring {
  width: 140px;
  height: 140px;
  margin: 0 auto 10px;
}

.progress-text {
  text-align: center;
  font-size: 20px;
  font-weight: 600;
}

ul {
  list-style: none;
  padding: 0;
}
li {
  border-bottom: 1px solid #eee;
  padding: 6px 0;
}
.small {
  font-size: 13px;
  color: #666;
}
canvas {
  width: 100%;
  height: 160px;
}
</style>
</head>

<body>

<h1>ðŸ’§ Liquid Tracker</h1>

<div class="card">
  <canvas id="ring" class="progress-ring"></canvas>
  <div class="progress-text" id="progressText"></div>
</div>

<div class="card">
  <input id="drinkName" placeholder="Drink name (Water, Coffee)">
  <input id="amount" type="number" placeholder="Amount">
  <select id="unit">
    <option value="oz">oz</option>
    <option value="ml">ml</option>
  </select>
  <button onclick="addDrink()">Add Drink</button>
</div>

<div class="card">
  <h2>Today</h2>
  <ul id="todayList"></ul>
</div>

<div class="card">
  <h2>7-Day Intake</h2>
  <canvas id="chart"></canvas>
</div>

<div class="card">
  <button class="secondary" onclick="exportData()">Export to Notes</button>
</div>

<script>
const STORAGE_KEY = "liquidTrackerState";

/* ---------------- STATE ---------------- */

function defaultState() {
  return {
    goalOz: 64,
    drinks: []
  };
}

function loadState() {
  return JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultState();
}

function saveState(state) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* ---------------- UTIL ---------------- */

function toOz(amount, unit) {
  return unit === "ml" ? amount * 0.033814 : amount;
}

function todayString() {
  return new Date().toDateString();
}

/* ---------------- CORE LOGIC ---------------- */

function addDrink() {
  const name = document.getElementById("drinkName").value || "Drink";
  const amount = Number(document.getElementById("amount").value);
  const unit = document.getElementById("unit").value;
  if (!amount) return;

  const state = loadState();
  state.drinks.push({
    name,
    amount,
    unit,
    time: Date.now()
  });

  saveState(state);
  document.getElementById("drinkName").value = "";
  document.getElementById("amount").value = "";

  render();
}

/* ---------------- RENDER ---------------- */

function render() {
  const state = loadState();
  const today = todayString();

  let todayTotal = 0;
  const todayList = document.getElementById("todayList");
  todayList.innerHTML = "";

  state.drinks.forEach(d => {
    if (new Date(d.time).toDateString() === today) {
      todayTotal += toOz(d.amount, d.unit);
      const li = document.createElement("li");
      li.textContent = `${d.name} â€” ${d.amount} ${d.unit}`;
      todayList.appendChild(li);
    }
  });

  drawRing(todayTotal, state.goalOz);
  document.getElementById("progressText").textContent =
    `${Math.round(todayTotal)} / ${state.goalOz} oz`;

  drawChart(state.drinks);
}

/* ---------------- RING ---------------- */

function drawRing(value, goal) {
  const canvas = document.getElementById("ring");
  const ctx = canvas.getContext("2d");
  canvas.width = canvas.height = 140;

  const percent = Math.min(value / goal, 1);
  const center = 70;
  const radius = 60;

  ctx.clearRect(0,0,140,140);

  ctx.lineWidth = 12;
  ctx.strokeStyle = "#e5e5ea";
  ctx.beginPath();
  ctx.arc(center, center, radius, 0, Math.PI * 2);
  ctx.stroke();

  ctx.strokeStyle = "#007aff";
  ctx.beginPath();
  ctx.arc(
    center,
    center,
    radius,
    -Math.PI / 2,
    -Math.PI / 2 + percent * Math.PI * 2
  );
  ctx.stroke();
}

/* ---------------- HEALTH-STYLE CHART ---------------- */

function drawChart(drinks) {
  const canvas = document.getElementById("chart");
  const ctx = canvas.getContext("2d");
  canvas.width = canvas.offsetWidth;
  canvas.height = 160;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  const days = [...Array(7)].map((_,i)=>{
    const d = new Date();
    d.setDate(d.getDate() - (6 - i));
    return d.toDateString();
  });

  const totals = days.map(day =>
    drinks
      .filter(d => new Date(d.time).toDateString() === day)
      .reduce((sum,d)=> sum + toOz(d.amount,d.unit), 0)
  );

  const max = Math.max(...totals, 64);
  const barWidth = canvas.width / 7;

  totals.forEach((val,i)=>{
    const h = (val / max) * 120;
    ctx.fillStyle = "#007aff";
    ctx.fillRect(
      i * barWidth + barWidth * 0.25,
      140 - h,
      barWidth * 0.5,
      h
    );
  });
}

/* ---------------- EXPORT ---------------- */

function exportData() {
  const state = loadState();
  let text = "Liquid Intake Log\n\n";

  state.drinks.forEach(d => {
    text += `${new Date(d.time).toLocaleString()} â€” ${d.name}: ${d.amount} ${d.unit}\n`;
  });

  navigator.clipboard.writeText(text);
  alert("Copied â€” paste into Apple Notes");
}

render();
</script>

</body>
</html>