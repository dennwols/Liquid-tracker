<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Liquid Tracker</title>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#ffffff">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f2f2f7;
  margin: 0;
  padding: 16px;
}
h1 { font-size: 28px; margin-bottom: 12px; }
h2 { font-size: 18px; margin-bottom: 8px; }

.card {
  background: white;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

input, select, button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

button {
  background: #007aff;
  color: white;
  border: none;
  font-weight: 600;
}

.secondary {
  background: #e5e5ea;
  color: black;
}

.progress-text {
  text-align: center;
  font-size: 20px;
  font-weight: 600;
}

.toggle {
  display: flex;
  gap: 8px;
}
.toggle button {
  flex: 1;
}
.toggle button.active {
  background: #007aff;
  color: white;
}

canvas {
  width: 100%;
  height: 160px;
}
</style>
</head>

<body>

<h1>ðŸ’§ Liquid Tracker - V1.0</h1>

<div class="card">
  <h2>Units</h2>
  <div class="toggle">
    <button id="ozBtn" onclick="setUnit('oz')">oz</button>
    <button id="mlBtn" onclick="setUnit('ml')">ml</button>
  </div>
</div>

<div class="card">
  <h2>Daily Goal</h2>
  <input id="goalInput" type="number" min="1" oninput="updateGoal()">
</div>

<div class="card">
  <canvas id="ring" width="140" height="140"></canvas>
  <div class="progress-text" id="progressText"></div>
</div>

<div class="card">
  <input id="drinkName" placeholder="Drink name">
  <input id="amount" type="number" placeholder="Amount">
  <button onclick="addDrink()">Add Drink</button>
</div>

<div class="card">
  <h2>Today</h2>
  <ul id="todayList"></ul>
</div>

<div class="card">
  <h2>7-Day Intake</h2>
  <canvas id="chart"></canvas>
</div>

<div class="card">
  <button class="secondary" onclick="enableReminder()">Enable Reminder</button>
  <button class="secondary" onclick="exportData()">Export to Notes</button>
<button class="secondary" onclick="logToHealth()">
  Log Today to Apple Health
</button>
</div>

<script>
const STORAGE_KEY = "liquidTrackerState";

function defaultState() {
  return {
    goalOz: 64,
    unit: "oz",
    drinks: []
  };
}

function loadState() {
  return JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultState();
}

function saveState(state) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function toOz(value, unit) {
  return unit === "ml" ? value * 0.033814 : value;
}

function fromOz(value, unit) {
  return unit === "ml" ? value / 0.033814 : value;
}

function setUnit(unit) {
  const state = loadState();
  state.unit = unit;
  saveState(state);
  render();
}

function updateGoal() {
  const state = loadState();
  const input = Number(document.getElementById("goalInput").value);
  if (input > 0) {
    state.goalOz = toOz(input, state.unit);
    saveState(state);
    render();
  }
}

function addDrink() {
  const name = document.getElementById("drinkName").value || "Drink";
  const amount = Number(document.getElementById("amount").value);
  if (!amount) return;

  const state = loadState();
  state.drinks.push({
    name,
    amountOz: toOz(amount, state.unit),
    time: Date.now()
  });

  saveState(state);
  document.getElementById("drinkName").value = "";
  document.getElementById("amount").value = "";
  render();
}

function render() {
  const state = loadState();
  const unit = state.unit;
  const today = new Date().toDateString();

  document.getElementById("ozBtn").classList.toggle("active", unit === "oz");
  document.getElementById("mlBtn").classList.toggle("active", unit === "ml");

  document.getElementById("goalInput").value =
    Math.round(fromOz(state.goalOz, unit));

  let totalOz = 0;
  const list = document.getElementById("todayList");
  list.innerHTML = "";

  state.drinks.forEach(d => {
    if (new Date(d.time).toDateString() === today) {
      totalOz += d.amountOz;
      const li = document.createElement("li");
      li.textContent =
        `${d.name} â€” ${Math.round(fromOz(d.amountOz, unit))} ${unit}`;
      list.appendChild(li);
    }
  });

  const displayTotal = Math.round(fromOz(totalOz, unit));
  const displayGoal = Math.round(fromOz(state.goalOz, unit));

  document.getElementById("progressText").textContent =
    `${displayTotal} / ${displayGoal} ${unit}`;

  drawRing(totalOz, state.goalOz);
  drawChart(state.drinks, unit);
}

function drawRing(value, goal) {
  const c = document.getElementById("ring");
  const ctx = c.getContext("2d");
  ctx.clearRect(0,0,140,140);

  const pct = Math.min(value / goal, 1);
  const center = 70, radius = 60;

  ctx.lineWidth = 12;
  ctx.strokeStyle = "#e5e5ea";
  ctx.beginPath();
  ctx.arc(center, center, radius, 0, Math.PI * 2);
  ctx.stroke();

  ctx.strokeStyle = "#007aff";
  ctx.beginPath();
  ctx.arc(center, center, radius, -Math.PI/2, -Math.PI/2 + pct * Math.PI*2);
  ctx.stroke();

  if (pct >= 1 && navigator.vibrate) navigator.vibrate(50);
}

function drawChart(drinks) {
  const canvas = document.getElementById("chart");
  const ctx = canvas.getContext("2d");
  canvas.width = canvas.offsetWidth;
  canvas.height = 160;

  const days = [...Array(7)].map((_,i)=>{
    const d = new Date();
    d.setDate(d.getDate() - (6 - i));
    return d.toDateString();
  });

  const totals = days.map(day =>
    drinks.filter(d => new Date(d.time).toDateString() === day)
          .reduce((s,d)=>s+d.amountOz,0)
  );

  const max = Math.max(...totals, loadState().goalOz);
  const bw = canvas.width / 7;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  totals.forEach((v,i)=>{
    const h = (v / max) * 120;
    ctx.fillStyle = "#007aff";
    ctx.fillRect(i*bw + bw*0.25, 140-h, bw*0.5, h);
  });
}

function exportData() {
  const s = loadState();
  let t = "Liquid Intake Log\n\n";
  s.drinks.forEach(d=>{
    t += `${new Date(d.time).toLocaleString()} â€” ${d.name}: ${Math.round(fromOz(d.amountOz,s.unit))} ${s.unit}\n`;
  });
  navigator.clipboard.writeText(t);
  alert("Copied to clipboard");
}
function logToHealth() {
  const state = loadState();
  const today = new Date().toDateString();

  const totalOz = state.drinks
    .filter(d => new Date(d.time).toDateString() === today)
    .reduce((s, d) => s + d.amountOz, 0);

  const ml = Math.round(totalOz / 0.033814);

  const text = `WATER_ML:${ml}`;
alert(text);
  if (navigator.share) {
    navigator.share({
      title: "Log Water to Health",
      text
    });
  } else {
    navigator.clipboard.writeText(text);
    alert("Copied for Health logging");
  }
}
function enableReminder() {
  Notification.requestPermission();
}

render();
</script>

</body>
</html>
